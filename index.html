<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="A live countdown until the next departure time of the University of Edinburgh's Shuttle Bus Service to and from both King's Buildings and Bristo Square.">
    <meta name="keywords" content="Edinburgh University Shuttle Bus, Edinburgh Shuttle, Edinburgh Shuttle Bus, Shuttle Bus Timetable, Edinburgh Shuttle Timetable, Edinburgh Uni Shuttle, King's Building Shuttle">
    <meta name="author" content="Jack L Smith">
    <link rel="icon" href="/fav.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="4o7tYkwMpDXRf1oA-fG8WzihH23llmTK_73tNOCM35s" />
    <title>When is the Next Shuttle?</title>

    <script>
        // This script runs first to prevent a flash of the wrong theme.
        // It checks for a saved theme in localStorage and applies it.
        (function () {
            const theme = localStorage.getItem('theme');
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');

        /* --- THEME VARIABLES --- */
        :root {
            --bg-gradient-start: #e0c3fc;
            --bg-gradient-end: #8ec5fc;
            --card-bg: rgba(255, 255, 255, 0.75);
            --button-group-bg: #e5e7eb;
            --button-active-bg: #ffffff;
            --button-hover-bg: rgba(255, 255, 255, 0.5);
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --accent-color: #3b82f6;
            --accent-color-dark: #2563eb;
            --shadow-color: rgba(0, 0, 0, 0.08);
            --card-border: rgba(255, 255, 255, 0.2);
            --footer-text: rgba(255, 255, 255, 0.9);
            --footer-link-border: rgba(255, 255, 255, 0.5);
            --footer-link-hover: #ffffff;
        }

        html.dark {
            --bg-gradient-start: #24243e;
            --bg-gradient-end: #1b1458;
            --card-bg: rgba(30, 30, 45, 0.75);
            --button-group-bg: #1e293b;
            --button-active-bg: #3b82f6;
            --button-hover-bg: rgba(51, 65, 85, 0.5);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent-color: #60a5fa;
            --accent-color-dark: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --card-border: rgba(255, 255, 255, 0.1);
            --footer-text: rgba(226, 232, 240, 0.8);
            --footer-link-border: rgba(226, 232, 240, 0.4);
            --footer-link-hover: #ffffff;
        }

        /* --- BASE STYLES --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: var(--text-primary);
            background-color: var(--bg-gradient-end);
            background-image: linear-gradient(62deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1.5rem;
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- THEME TOGGLE BUTTON --- */
        #theme-toggle {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px var(--shadow-color);
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        #theme-toggle:hover {
            transform: scale(1.1);
        }

        #theme-toggle svg {
            width: 24px;
            height: 24px;
            color: var(--text-primary);
            transition: color 0.3s ease;
        }

        #theme-toggle-dark-icon {
            display: none;
        }

        html.dark #theme-toggle-light-icon {
            display: none;
        }

        html.dark #theme-toggle-dark-icon {
            display: block;
        }


        /* --- MAIN CONTENT STYLES --- */
        .container {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--card-border);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 32px 0 var(--shadow-color);
            width: 100%;
            max-width: 550px;
            text-align: center;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .container:first-of-type {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
        }

        .container:nth-of-type(2) {
            padding: 2.5rem;
        }

        h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        h2 {
            font-size: 1.125rem;
            font-weight: 400;
            color: var(--text-secondary);
        }

        .button-group {
            display: flex;
            background-color: var(--button-group-bg);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 2rem;
            transition: background-color 0.3s ease;
        }

        .button-group button {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            padding: 0.75rem 1rem;
            /* margin-left: 0.5rem; */
            /* margin-right: 0.1rem; */
            border: none;
            border-radius: 9px;
            cursor: pointer;
            background-color: transparent;
            color: var(--text-secondary);
            width: 50%;
            flex-grow: 1;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .button-group button.active {
            background-color: var(--button-active-bg);
            color: var(--accent-color-dark);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.07);
        }

        .button-group button:not(.active):hover {
            background-color: var(--button-hover-bg);
            color: var(--text-primary);
        }

        .time-display {
            /* margin-top: 20px; */
            transition: color 0.3s ease;
        }

        #timeDisplayTop {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        #timeDisplayMiddle {
            font-size: 3rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.05em;
            line-height: 1.1;
        }

        #timeDisplayBottom {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        #timeDisplayUnderneath,
        #timeDisplayUnderUnder {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            line-height: 1.4;
        }

        #timeDisplayUnderneath {
            margin-top: 2rem;
        }

        hr#next-bus-styling2,
        br#next-bus-styling1 {
            display: none;
        }

        /* --- FOOTER STYLES --- */
        .footer {
            position: relative;
            font-size: 0.875rem;
            color: var(--footer-text);
            width: 100%;
            max-width: 500px;
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 2rem;
        }

        .footer a {
            color: var(--footer-text);
            font-weight: 500;
            text-decoration: none;
            transition: all 0.3s ease;
            border-bottom: 1px solid var(--footer-link-border);
        }

        .footer a.link-hidden {
            border-bottom: none;
        }

        .footer a:hover {
            color: var(--footer-link-hover);
            border-bottom-color: var(--footer-link-hover);
        }

        .footer img {
            margin-top: 1rem;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .footer img:hover {
            opacity: 1;
        }

        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            #theme-toggle {
                top: 1rem;
                right: 1rem;
            }

            .container {
                padding: 1.5rem;
                border-radius: 12px;
            }

            .container:first-of-type {
                margin-bottom: 1rem;
                padding: 1rem;
            }

            .container:nth-of-type(2) {
                padding: 2rem 1.5rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1rem;
            }

            .button-group button {
                font-size: 0.9rem;
                padding: 0.6rem 0.5rem;
            }

            #timeDisplayMiddle {
                font-size: 2.5rem !important;
            }

            #timeDisplayBottom {
                font-size: 1rem;
            }
        }
    </style>
</head>

<body>

    <button id="theme-toggle" title="Toggle dark mode">
        <svg id="theme-toggle-light-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
            stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
        </svg>
        <svg id="theme-toggle-dark-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
            stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
        </svg>
    </button>


    <div class="container">
        <h1>Edinburgh University Shuttle Bus</h1>
        <h2>When is the Next Bus?</h2>
    </div>
    <div class="container">
        <div class="button-group">
            <button id="routeKB" class="active">To Bristo Square</button>
            <button id="routeBK">To King's Buildings</button>
        </div>
        <!-- <br style="visibility: hidden;" , id="next-bus-styling1"> -->
        <div class="time-display" id="timeDisplayTop">Next departure in:</div>
        <br>
        <div class="time-display" id="timeDisplayMiddle">--:--:--</div>
        <div class="time-display" id="timeDisplayBottom" style="margin-bottom: 0;">at --:--</div>
        <br>
        <!-- <br style="width: 20%; padding: 0; visibility: hidden;" id="next-bus-styling2"> -->
        <!-- <br> -->
        <div class="time-display" id="timeDisplayUnderneath" style="margin-top:0;"></div>
        <div class="time-display" id="timeDisplayUnderUnder"></div>
    </div>

    <div class="footer">
        <a class="link" href="https://transport.ed.ac.uk/public-transport/shuttle-bus" target="_blank">Full
            Timetable</a>
        <br>
        Current time is <span id="currentTime"></span>
        <br><br>
        Copyright &copy; <span id="currentYear"></span>
        <a class="link-hidden" href="https://www.linkedin.com/in/jack-l-smith/" target="_blank">Jack L Smith</a>
        <br>
        Not affiliated with the University of Edinburgh's Shuttle Bus Service
        <!--Feedback &amp; bugs: <a style="color: #664;" href="www.google.com">www.google.com</a> -->
        <br><br>
        <a href="https://visitorbadge.io/status?path=https://jack6228.github.io/Next-Shuttle-Bus"><img id="visitor-badge" src="https://api.visitorbadge.io/api/daily?path=https%3A%2F%2Fjack6228.github.io%2FNext-Shuttle-Bus%2Fv&label=VisitorCount&labelColor=%23add8e6&countColor=%2300  56b3&labelStyle=lower" /></a>
    </div>
    <script>
        // --- THEME TOGGLE SCRIPT ---
        const themeToggleBtn = document.getElementById('theme-toggle');
        const visitorBadge = document.getElementById('visitor-badge');

        const lightBadgeSrc = "https://api.visitorbadge.io/api/daily?path=https%3A%2F%2Fjack6228.github.io%2FNext-Shuttle-Bus%2Fv&label=VisitorCount&labelColor=%23add8e6&countColor=%230056b3&labelStyle=lower";
        const darkBadgeSrc = "https://api.visitorbadge.io/api/daily?path=https%3A%2F%2Fjack6228.github.io%2FNext-Shuttle-Bus%2Fv&label=VisitorCount&labelColor=%23374151&countColor=%239ca3af&labelStyle=lower";

        const updateVisitorBadge = (theme) => {
            if (theme === 'dark') {
                visitorBadge.src = darkBadgeSrc;
            } else {
                visitorBadge.src = lightBadgeSrc;
            }
        };

        // Set initial badge based on theme
        if (document.documentElement.classList.contains('dark')) {
            updateVisitorBadge('dark');
        }

        themeToggleBtn.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');

            let theme = 'light';
            if (document.documentElement.classList.contains('dark')) {
                theme = 'dark';
            }
            localStorage.setItem('theme', theme);
            updateVisitorBadge(theme);
        });


        // --- ORIGINAL APP SCRIPT ---
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        function updateCurrentTime() {
            const now = new Date().toLocaleString('en-GB', {
                timeZone: 'Europe/London',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('currentTime').textContent = now;
        }
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);

        const routeBKTimes = [
            { departure: "08:18", arrival: "08:32" }, { departure: "08:38", arrival: "08:52" }, { departure: "09:08", arrival: "09:22" }, { departure: "09:33", arrival: "09:47" }, { departure: "09:53", arrival: "10:07" }, { departure: "10:13", arrival: "10:27" }, { departure: "10:33", arrival: "10:47" }, { departure: "10:53", arrival: "11:07" }, { departure: "11:13", arrival: "11:27" }, { departure: "11:33", arrival: "11:47" }, { departure: "11:53", arrival: "12:07" }, { departure: "12:13", arrival: "12:27" }, { departure: "12:33", arrival: "12:47" }, { departure: "12:53", arrival: "13:07" }, { departure: "13:13", arrival: "13:27" }, { departure: "13:33", arrival: "13:47" }, { departure: "13:53", arrival: "14:07" }, { departure: "14:13", arrival: "14:27" }, { departure: "14:33", arrival: "14:47" }, { departure: "14:53", arrival: "15:07" }, { departure: "15:13", arrival: "15:27" }, { departure: "15:33", arrival: "15:47" }, { departure: "15:53", arrival: "16:11" }, { departure: "16:23", arrival: "16:41" }, { departure: "16:53", arrival: "17:11" }, { departure: "17:23", arrival: "17:41" }, { departure: "17:53", arrival: "18:11" }
        ];

        const routeKBTimes = [
            { departure: "08:35", arrival: "08:46" }, { departure: "09:05", arrival: "09:16" }, { departure: "09:35", arrival: "09:46" }, { departure: "09:55", arrival: "10:06" }, { departure: "10:15", arrival: "10:26" }, { departure: "10:35", arrival: "10:46" }, { departure: "10:55", arrival: "11:06" }, { departure: "11:15", arrival: "11:26" }, { departure: "11:35", arrival: "11:46" }, { departure: "11:55", arrival: "12:06" }, { departure: "12:15", arrival: "12:26" }, { departure: "12:35", arrival: "12:46" }, { departure: "12:55", arrival: "13:06" }, { departure: "13:15", arrival: "13:26" }, { departure: "13:35", arrival: "13:46" }, { departure: "13:55", arrival: "14:06" }, { departure: "14:15", arrival: "14:26" }, { departure: "14:35", arrival: "14:46" }, { departure: "14:55", arrival: "15:06" }, { departure: "15:15", arrival: "15:26" }, { departure: "15:35", arrival: "15:46" }, { departure: "15:55", arrival: "16:10" }, { departure: "16:25", arrival: "16:40" }, { departure: "16:55", arrival: "17:10" }, { departure: "17:25", arrival: "17:40" }, { departure: "17:55", arrival: "18:10" }, { departure: "18:25", arrival: "18:40" }
        ];

        const routeDates = [
            { start: "2025-09-08T00:00:00", end: "2025-12-19T23:59:59" }, 
            { start: "2026-01-12T00:00:00", end: "2026-04-03T23:59:59" }, 
            { start: "2026-04-20T00:00:00", end: "2026-05-22T23:59:59" }
        ];

        let currentRoute = routeKBTimes;
        let currentDestination = 'Bristo Square';

        document.getElementById('routeBK').addEventListener('click', () => {
            currentRoute = routeBKTimes;
            currentDestination = 'King\'s Buildings';
            updateActiveButton('routeBK');
            updateTimeDisplay();
        });
        document.getElementById('routeKB').addEventListener('click', () => {
            currentRoute = routeKBTimes;
            currentDestination = 'Bristo Square';
            updateActiveButton('routeKB');
            updateTimeDisplay();
        });

        function updateActiveButton(activeButtonId) {
            document.getElementById('routeBK').classList.remove('active');
            document.getElementById('routeKB').classList.remove('active');
            document.getElementById(activeButtonId).classList.add('active');
        }

        function isValidDate(currentDateTime) {
            const dateRanges = routeDates.map(range => ({
                start: new Date(range.start),
                end: new Date(range.end)
            }));
            const isWeekday = currentDateTime.getDay() >= 1 && currentDateTime.getDay() <= 5;
            const isWithinRange = dateRanges.some(range => {
                const startTime = range.start.getTime();
                const endTime = range.end.getTime();
                const currentTime = currentDateTime.getTime();
                return currentTime >= startTime && currentTime <= endTime;
            });
            return [isWeekday, isWithinRange];
        }

        function getNextDepartureTimeTime() {
            const now = new Date().toLocaleString('en-US', { timeZone: 'Europe/London' });
            const currentDateTime = new Date(now);

            // For testing:
            // Subtract N hours from the current time
            // currentDateTime.setHours(currentDateTime.getHours() - 1);            
            // and adjust the date
            // currentDateTime.setFullYear(2025, 9, 17);

            const dateRanges = routeDates.map(range => ({ start: new Date(range.start), end: new Date(range.end) }));
            const [isWeekday, isWithinRange] = isValidDate(currentDateTime);
            const departuresLeftToday = currentRoute.filter(time => {
                const [hours, minutes] = time.departure.split(':');
                const departureDateTime = new Date(currentDateTime);
                departureDateTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                return departureDateTime > currentDateTime;
            });
            const today = new Date(currentDateTime);
            today.setHours(0, 0, 0, 0);
            const departureTimes = currentRoute.map(time => {
                const [hours, minutes] = time.departure.split(':');
                const departureDateTime = new Date(today);
                departureDateTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                return departureDateTime;
            });
            const nextDepartureTime = departureTimes.find(time => time > currentDateTime);
            if (!nextDepartureTime || (!isWeekday || !isWithinRange)) {
                let nextDepartureDate = new Date(today);
                nextDepartureDate.setDate(nextDepartureDate.getDate() + 1);
                if (nextDepartureDate > dateRanges[dateRanges.length - 1].end) {
                    return { responseStatus: 'outOfService' };
                }
                while (!isValidDate(nextDepartureDate)[0] || !isValidDate(nextDepartureDate)[1]) {
                    nextDepartureDate.setDate(nextDepartureDate.getDate() + 1);
                }
                return {
                    responseStatus: 'nextDepartureDate',
                    nextDepartureTime: departureTimes[0].toLocaleTimeString('en-GB', { timeZone: 'Europe/London', hour: '2-digit', minute: '2-digit' }),
                    nextDepartureDate: nextDepartureDate.toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long' })
                };
            }
            const timeDiffMs = nextDepartureTime - currentDateTime;
            const hoursRemaining = Math.floor(timeDiffMs / (1000 * 60 * 60));
            const minutesRemaining = Math.floor((timeDiffMs % (1000 * 60 * 60)) / (1000 * 60));
            const secondsRemaining = Math.floor((timeDiffMs % (1000 * 60)) / 1000);
            const futureDepartures = departuresLeftToday.slice(1, 4).map(time => time.departure);
            if (futureDepartures.length === 0) {
                futureDepartures.push('-');
            }
            return {
                responseStatus: 'success',
                nextDepartureTime: nextDepartureTime.toLocaleTimeString('en-GB', { timeZone: 'Europe/London', hour: '2-digit', minute: '2-digit' }),
                timeRemaining: `${hoursRemaining}h ${minutesRemaining}m ${secondsRemaining}s`,
                futureDepartures: futureDepartures
            };
        }

        function updateTimeDisplay() {
            const result = getNextDepartureTimeTime();
            const timeDisplayTop = document.getElementById('timeDisplayTop');
            const timeDisplayMiddle = document.getElementById('timeDisplayMiddle');
            const timeDisplayBottom = document.getElementById('timeDisplayBottom');
            const timeDisplayUnderneath = document.getElementById('timeDisplayUnderneath');
            const timeDisplayUnderUnder = document.getElementById('timeDisplayUnderUnder');
            const last_departure = currentRoute[currentRoute.length - 1].departure;

            timeDisplayUnderneath.innerText = '';
            timeDisplayUnderUnder.innerText = '';
            timeDisplayTop.innerHTML = '';
            timeDisplayMiddle.style.fontSize = '';
            timeDisplayMiddle.style.fontWeight = 'normal';

            if (result.responseStatus === 'nextDepartureDate') {
                timeDisplayTop.innerHTML = `Next shuttle to <b style="font-size:1.15em;">${currentDestination}</b> is at`;
                timeDisplayMiddle.innerHTML = `<b>${result.nextDepartureTime}</b>`;
                timeDisplayBottom.innerText = `on ${result.nextDepartureDate}`;
            } else if (result.responseStatus === 'outOfService') {
                timeDisplayMiddle.innerText = 'No departures soon';
                timeDisplayBottom.innerText = 'The shuttle is now out of service until next semester';
            } else {
                timeDisplayTop.innerHTML = `Next departure to <b style="font-size:1.15em;">${currentDestination}</b> in:`;
                timeDisplayMiddle.innerText = result.timeRemaining.startsWith('0h ') ? result.timeRemaining.slice(3) : result.timeRemaining;
                timeDisplayMiddle.style.fontSize = '3em';
                timeDisplayMiddle.style.fontWeight = 'bold';
                timeDisplayBottom.innerText = `at ${result.nextDepartureTime}`;
                timeDisplayUnderneath.innerText = `Later departures: ${result.futureDepartures.join(', ')}`;
                timeDisplayUnderUnder.innerText = `Last departure today: ${last_departure}`;
            }
        }
        updateTimeDisplay();
        setInterval(updateTimeDisplay, 1000);
    </script>
</body>

</html>